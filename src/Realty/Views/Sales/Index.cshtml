@model IEnumerable<Sale>
@{
   var isRealtor = ViewBag.CurrentUser.IsRealtor;
   var isAdmin = ViewBag.CurrentUser.IsAdmin;
}

<div class="wrapper wrapper-content animated fadeIn ecommerce">
  <div class="ibox-content m-b-sm border-bottom">
    <span class="text-muted small pull-right">Last modification: <i class="fa fa-clock-o"></i> 2:10 pm - 12/02/2016</span>
    <h2>Sales</h2>
    <p>Contains the list of sales.</p>
  </div>

  <div class="row">
    <div class="col-lg-12">
      <div class="ibox">
        <div class="ibox-content border-bottom">
          <div class="sales-list">
            <ul class="nav nav-tabs">
              @if(isAdmin)
              {
                <span class="pull-right small text-muted">@($"Total sales: {Model.Count()}")</span>
              }
              @if(isAdmin || isRealtor)
              {
                <li class="active"><a data-toggle="tab" href="#tab-1"><i class="fa fa-shopping-bag"></i> All Sales</a></li>
                <li><a data-toggle="tab" href="#tab-2"><i class="fa fa-shopping-bag"></i> My Sales</a></li>
              }
              else
              {
                <li class="active"><a data-toggle="tab" href="#tab-2"><i class="fa fa-shopping-bag"></i> My Sales</a></li>
              }
              @if(isRealtor)
              {
                <li><a data-toggle="tab" href="#tab-3"><i class="fa fa-shopping-bag"></i> Realtor Sales</a></li>
              }
            </ul>

            <div class="tab-content">
              @if(isAdmin || isRealtor)
              {
                <div id="tab-1" class="tab-pane active">
                  <div class="full-height-scroll">
                    <div class="table-responsive">
                      <table class="footable table table-striped table-hover" data-page-size="15">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Listing</th>
                            <th>Type</th>
                            <th>Realtor</th>
                            <th>Price</th>
                            <th>Realtor Fee</th>
                            <th class="text-center">Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          @foreach(var sale in Model)
                          {
                            <tr>
                              <td>@sale.Id</td>
                              <td>@sale.SoldAt</td>
                              <td>@sale.Offer.Listing.Id</td>
                              <td>@sale.Offer.Listing.Property.PropertyType.Name</td>
                              <td>@sale.Offer.Listing.Realtor.Person.FullName</td>
                              <td>@sale.Offer.OfferPrice.Value.ToString("C")</td>
                              <td>@sale.RealtorFee.ToString("C")</td>
                              <td><a class="btn btn-info btn-xs" asp-action="Show" asp-route-saleId="@sale.Id">View</a></td>
                            </tr>
                          }
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              }

              @{ var active = !isAdmin && !isRealtor ? "active" : ""; }

              <div id="tab-2" class="tab-pane @active">
                <div class="full-height-scroll">
                  <div class="table-responsive">
                    <table class="table table-striped table-hover">
                      <thead>
                      <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Listing</th>
                        <th>Type</th>
                        <th>Realtor</th>
                        <th>Price</th>
                        <th>Realtor Fee</th>
                        <th class="text-center">Action</th>
                      </tr>
                      </thead>
                      <tbody>
                      @foreach(var sale in ViewBag.MySales)
                      {
                        <tr>
                          <td>@sale.Id</td>
                          <td>@sale.SoldAt</td>
                          <td>@sale.Offer.Listing.Id</td>
                          <td>@sale.Offer.Listing.Property.PropertyType.Name</td>
                          <td>@sale.Offer.Listing.Realtor.Person.FullName</td>
                          <td>@sale.Offer.OfferPrice.ToString("C")</td>
                          <td>@sale.RealtorFee.ToString("C")</td>
                          <td><a class="btn btn-info btn-xs" asp-action="Show" asp-route-saleId="@sale.Id">View</a></td>
                        </tr>
                      }
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              @if(isRealtor)
              {
                <div id="tab-3" class="tab-pane">
                  <div class="full-height-scroll">
                    <div class="table-responsive">
                      <table class="table table-striped table-hover">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Listing</th>
                            <th>Type</th>
                            <th>Realtor</th>
                            <th>Price</th>
                            <th>Realtor Fee</th>
                            <th class="text-center">Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          @foreach(var sale in ViewBag.RealtorSales)
                          {
                            <tr>
                              <td>@sale.Id</td>
                              <td>@sale.SoldAt</td>
                              <td>@sale.Offer.Listing.Id</td>
                              <td>@sale.Offer.Listing.Property.PropertyType.Name</td>
                              <td>@sale.Offer.Listing.Realtor.Person.FullName</td>
                              <td>@sale.Offer.OfferPrice.ToString("C")</td>
                              <td>@sale.RealtorFee.ToString("C")</td>
                              <td><a class="btn btn-info btn-xs" asp-action="Show" asp-route-saleId="@sale.Id">View</a></td>
                            </tr>
                          }
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              }


            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
